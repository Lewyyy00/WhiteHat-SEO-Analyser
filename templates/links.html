{% extends "layout.html" %}

{% block title %}Internal Links{% endblock %}

{% block content %}
<h1>Internal Links for {{ url }}</h1>
<ul id="links-list">
  {% for link in links %}
  <li onclick="selectLink('{{ link }}', event)">{{ link }}</li>
  {% endfor %}
</ul>
{% endblock %}

<div class="details">
  <h2>Options</h2>
  <button onclick="fetchMeta(selectedLink, 'title')">Show Title</button>
  <button onclick="fetchMeta(selectedLink, 'meta_description')">Show Meta Description</button>
  <button onclick="fetchMeta(selectedLink, 'headings')">Show Headings</button>
  <div id="result"></div>
</div>

<script>
  let selectedLink = null;

  function selectLink(link, event) {
    selectedLink = link;
    document.querySelectorAll('#links-list li').forEach(li => {
      li.classList.remove('selected');
    });
    event.target.classList.add('selected');
  }

  function fetchMeta(url, option) {
    if (!url) {
      alert('Please select a link first.');
      return;
    }

    fetch('/fetch_meta', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ url: url, option: option })
    })
    .then(response => response.json())
    .then(data => {
      let resultDiv = document.getElementById('result');
      if (data.html) {
        resultDiv.innerHTML = data.html;
      } else {
        resultDiv.innerHTML = JSON.stringify(data, null, 2);
      }
    });
  }
</script>
